{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block title %}Reset Your Password{% endblock %}

{% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6 col-xl-5">
      <!-- Using the content-card for a consistent, styled container -->
      <div class="content-card">
        
        <!-- Header Section -->
        <div class="text-center mb-4">
          <i class="bi bi-key-fill text-primary" style="font-size: 3rem;"></i>
          <h1 class="h3 mt-2 mb-2">Set a New Password</h1>
          <p class="text-muted">Enter the code from your email and create a new, secure password.</p>
        </div>

        <!-- Reset Password Form -->
        <form method="post" novalidate>
          {% csrf_token %}

          <!-- OTP Field -->
          <div class="mb-3 text-start">
            <label for="id_otp" class="form-label">Verification Code</label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-shield-check"></i></span>
                <input
                  type="text"
                  name="otp"
                  id="id_otp"
                  class="form-control"
                  required
                  placeholder="6-digit code from email"
                  value="{{ request.POST.otp|default:'' }}"
                  autocomplete="one-time-code">
            </div>
          </div>

          <!-- New Password Field with Show/Hide Toggle -->
          <div class="mb-4 text-start">
            <label for="id_new_password" class="form-label">New Password</label>
            <div class="input-group">
                <span class="input-group-text"><i class="bi bi-lock"></i></span>
                <input
                  type="password"
                  name="new_password"
                  id="id_new_password"
                  class="form-control"
                  required
                  placeholder="Create a strong password"
                  autocomplete="new-password">
                <button class="btn btn-outline-secondary" type="button" id="togglePasswordBtn" aria-label="Toggle password visibility">
                  <i class="bi bi-eye-slash" id="togglePasswordIcon"></i>
                </button>
            </div>
            <div class="form-text mt-2">
              Use 8+ characters with a mix of letters, numbers & symbols.
            </div>
          </div>

          <!-- Submit Button -->
          <div class="d-grid">
            <button type="submit" class="btn btn-primary btn-lg">
              <i class="bi bi-check-circle me-2"></i>Reset Password
            </button>
          </div>
        </form>
      </div>

      <!-- Footer link back to login -->
      <div class="text-center mt-4">
        <a href="{% url 'login' %}" class="text-decoration-none">
          <i class="bi bi-arrow-left me-1"></i> Back to Login
        </a>
      </div>
    </div>
  </div>
</div>

<!-- **FIX:** Moved the script inside the content block to ensure it loads after the HTML elements -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const passwordInput = document.getElementById('id_new_password');
  const toggleBtn = document.getElementById('togglePasswordBtn');
  const toggleIcon = document.getElementById('togglePasswordIcon');

  if (passwordInput && toggleBtn && toggleIcon) {
    toggleBtn.addEventListener('click', function() {
      const isPassword = passwordInput.type === 'password';
      passwordInput.type = isPassword ? 'text' : 'password';
      toggleIcon.classList.toggle('bi-eye-slash', !isPassword);
      toggleIcon.classList.toggle('bi-eye', isPassword);
    });
  }
});
</script>
{% endblock %}

